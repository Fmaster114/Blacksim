<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Baumwoll-Farmer</title>
<style>
  body { margin:0; background:#87ceeb; font-family:sans-serif; }
  canvas { display:block; margin:auto; background:#4caf50; }
  #info {
    position:absolute; top:10px; left:10px;
    background:rgba(0,0,0,0.6);
    color:white; padding:10px; border-radius:8px;
    font-size:18px;
  }
</style>
</head>
<body>

<div id="info">ðŸŒ¿ Baumwolle: <span id="cotton">0</span></div>
<canvas id="game" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

let cotton = 0;
const keys = {};
let tick = 0;

// ---------------- Farmer ----------------
const farmer = {
  x: 400,
  y: 300,
  size: 18,
  speed: 3
};

// ---------------- Pflanzen ----------------
const plants = [];
const GROW_TIME = 5000;

for (let x = 120; x <= 680; x += 120) {
  for (let y = 120; y <= 480; y += 120) {
    plants.push({
      x, y,
      stage: 3,
      lastGrow: Date.now()
    });
  }
}

// ---------------- Input ----------------
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ---------------- Update ----------------
function update() {
  tick++;

  if (keys["w"] || keys["ArrowUp"]) farmer.y -= farmer.speed;
  if (keys["s"] || keys["ArrowDown"]) farmer.y += farmer.speed;
  if (keys["a"] || keys["ArrowLeft"]) farmer.x -= farmer.speed;
  if (keys["d"] || keys["ArrowRight"]) farmer.x += farmer.speed;

  farmer.x = Math.max(20, Math.min(780, farmer.x));
  farmer.y = Math.max(40, Math.min(580, farmer.y));

  plants.forEach(p => {
    if (p.stage < 3 && Date.now() - p.lastGrow > GROW_TIME) {
      p.stage++;
      p.lastGrow = Date.now();
    }
  });

  if (keys[" "]) {
    plants.forEach(p => {
      const d = Math.hypot(p.x - farmer.x, p.y - farmer.y);
      if (d < 35 && p.stage === 3) {
        p.stage = 0;
        p.lastGrow = Date.now();
        cotton++;
        document.getElementById("cotton").textContent = cotton;
      }
    });
  }
}

// ---------------- Draw Helpers ----------------
function drawGround() {
  ctx.fillStyle = "#3e8e41";
  ctx.fillRect(0,0,800,600);

  ctx.strokeStyle = "rgba(0,0,0,0.1)";
  for (let y = 100; y < 600; y += 40) {
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(800,y);
    ctx.stroke();
  }
}

// ---------------- Draw ----------------
function drawPlant(p) {
  const sway = Math.sin(tick / 20 + p.x) * 2;

  // Stiel
  ctx.strokeStyle = "#2e7d32";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(p.x, p.y + sway);
  ctx.lineTo(p.x, p.y + 28);
  ctx.stroke();

  const sizes = [6, 9, 12, 15];
  const colors = ["#8d6e63", "#d7ccc8", "#eeeeee", "#ffffff"];
  const r = sizes[p.stage];

  for (let i = -1; i <= 1; i++) {
    ctx.beginPath();
    ctx.arc(p.x + i * (r * 0.7), p.y + sway, r, 0, Math.PI * 2);
    ctx.fillStyle = colors[p.stage];
    ctx.fill();
    ctx.strokeStyle = "#aaa";
    ctx.stroke();
  }
}

function drawFarmer() {
  // Schatten
  ctx.fillStyle = "rgba(0,0,0,0.2)";
  ctx.beginPath();
  ctx.ellipse(farmer.x, farmer.y + 32, 18, 6, 0, 0, Math.PI * 2);
  ctx.fill();

  // Kopf (DEIN Skin bleibt)
  ctx.fillStyle = "#573E1F";
  ctx.beginPath();
  ctx.arc(farmer.x, farmer.y - 10, farmer.size, 0, Math.PI * 2);
  ctx.fill();

  // Hut
  ctx.fillStyle = "#6d4c41";
  ctx.fillRect(farmer.x - 22, farmer.y - 34, 44, 6);
  ctx.fillRect(farmer.x - 14, farmer.y - 48, 28, 14);

  // KÃ¶rper
  ctx.fillStyle = "#1976d2";
  ctx.fillRect(farmer.x - 14, farmer.y, 28, 34);
}

function draw() {
  drawGround();
  plants.forEach(drawPlant);
  drawFarmer();
}

// ---------------- Loop ----------------
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}

loop();
</script>
</body>
</html>
