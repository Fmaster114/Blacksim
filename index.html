<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Baumwoll-Farmer Pixelart</title>
<style>
  body {
    margin: 0;
    background: #87ceeb;
    overflow: hidden;
    font-family: sans-serif;
  }
  canvas {
    display: block;
    margin: auto;
    background: #4caf50;
    image-rendering: pixelated;
  }
  #info {
    position: fixed;
    top: 10px;
    left: 10px;
    background: rgba(0,0,0,0.6);
    color: white;
    padding: 8px 12px;
    border-radius: 8px;
    font-size: 16px;
    z-index: 10;
  }
</style>
</head>
<body>

<div id="info">ðŸŒ¿ Baumwolle: <span id="cotton">0</span></div>
<canvas id="game" width="800" height="600"></canvas>

<script defer>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");
ctx.imageSmoothingEnabled = false;

// ---------------- Welt ----------------
const WORLD_WIDTH = 2000;
const WORLD_HEIGHT = 2000;

// ---------------- Mini-Map ----------------
const MINIMAP_SIZE = 160;
const MINIMAP_PADDING = 10;

// ---------------- State ----------------
let cotton = 0;
const keys = {};
const particles = [];

// ---------------- Kamera ----------------
const camera = { x: 0, y: 0 };

// ---------------- Farmer ----------------
const farmer = {
  x: 1000,
  y: 1000,
  speed: 3
};

// ---------------- Pflanzen ----------------
const plants = [];
const GROW_TIME = 5000;

for (let x = 200; x < WORLD_WIDTH; x += 120) {
  for (let y = 200; y < WORLD_HEIGHT; y += 120) {
    plants.push({
      x, y,
      stage: 3,
      lastGrow: Date.now()
    });
  }
}

// ---------------- Input ----------------
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ---------------- Partikel ----------------
function spawnParticles(x, y) {
  for (let i = 0; i < 8; i++) {
    particles.push({
      x, y,
      vx: (Math.random() - 0.5) * 2,
      vy: Math.random() * -2,
      life: 30
    });
  }
}

// ---------------- Update ----------------
function update() {
  if (keys["w"] || keys["ArrowUp"]) farmer.y -= farmer.speed;
  if (keys["s"] || keys["ArrowDown"]) farmer.y += farmer.speed;
  if (keys["a"] || keys["ArrowLeft"]) farmer.x -= farmer.speed;
  if (keys["d"] || keys["ArrowRight"]) farmer.x += farmer.speed;

  farmer.x = Math.max(40, Math.min(WORLD_WIDTH - 40, farmer.x));
  farmer.y = Math.max(40, Math.min(WORLD_HEIGHT - 40, farmer.y));

  camera.x = Math.floor(farmer.x - canvas.width / 2);
  camera.y = Math.floor(farmer.y - canvas.height / 2);

  plants.forEach(p => {
    if (p.stage < 3 && Date.now() - p.lastGrow > GROW_TIME) {
      p.stage++;
      p.lastGrow = Date.now();
    }
  });

  if (keys[" "]) {
    plants.forEach(p => {
      const d = Math.hypot(p.x - farmer.x, p.y - farmer.y);
      if (d < 32 && p.stage === 3) {
        p.stage = 0;
        p.lastGrow = Date.now();
        cotton++;
        document.getElementById("cotton").textContent = cotton;
        spawnParticles(p.x, p.y);
      }
    });
  }

  particles.forEach(pt => {
    pt.x += pt.vx;
    pt.y += pt.vy;
    pt.vy += 0.15;
    pt.life--;
  });

  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i].life <= 0) particles.splice(i, 1);
  }
}

// ---------------- Helpers ----------------
const wx = x => Math.floor(x - camera.x);
const wy = y => Math.floor(y - camera.y);

// ---------------- Draw ----------------
function drawGround() {
  ctx.fillStyle = "#3e8e41";
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  ctx.fillStyle = "#357a38";
  for (let y = -camera.y % 64; y < canvas.height; y += 64) {
    ctx.fillRect(0, y, canvas.width, 2);
  }
}

function drawPlant(p) {
  const px = wx(p.x);
  const py = wy(p.y);

  ctx.fillStyle = "rgba(0,0,0,0.3)";
  ctx.fillRect(px - 10, py + 24, 20, 6);

  ctx.fillStyle = "#2e7d32";
  ctx.fillRect(px - 2, py, 4, 28);

  const layouts = [
    [],
    [[0,0]],
    [[-6,0],[6,0]],
    [[-6,0],[6,0],[0,-6]]
  ];

  layouts[p.stage].forEach(o => {
    ctx.fillStyle = "#00000055";
    ctx.fillRect(px + o[0] - 5, py + o[1] + 3, 10, 6);

    ctx.fillStyle = "#ffffff";
    ctx.fillRect(px + o[0] - 6, py + o[1] - 6, 12, 12);

    ctx.fillStyle = "#eeeeee";
    ctx.fillRect(px + o[0] - 4, py + o[1] - 4, 5, 5);
  });
}

function drawFarmer() {
  const x = wx(farmer.x);
  const y = wy(farmer.y);

  ctx.fillStyle = "rgba(0,0,0,0.35)";
  ctx.fillRect(x - 10, y + 28, 20, 6);

  ctx.fillStyle = "#573E1F";
  ctx.fillRect(x - 8, y - 20, 16, 16);

  ctx.fillStyle = "#1976d2";
  ctx.fillRect(x - 10, y, 20, 28);
}

function drawParticles() {
  particles.forEach(p => {
    ctx.fillStyle = "rgba(255,255,255," + (p.life / 30) + ")";
    ctx.fillRect(wx(p.x), wy(p.y), 4, 4);
  });
}

function drawMiniMap() {
  const scaleX = MINIMAP_SIZE / WORLD_WIDTH;
  const scaleY = MINIMAP_SIZE / WORLD_HEIGHT;

  const x0 = canvas.width - MINIMAP_SIZE - MINIMAP_PADDING;
  const y0 = MINIMAP_PADDING;

  ctx.fillStyle = "#1b5e20";
  ctx.fillRect(x0, y0, MINIMAP_SIZE, MINIMAP_SIZE);

  plants.forEach(p => {
    if (p.stage === 3) {
      ctx.fillStyle = "#ffffff";
      ctx.fillRect(
        x0 + Math.floor(p.x * scaleX),
        y0 + Math.floor(p.y * scaleY),
        2, 2
      );
    }
  });

  ctx.fillStyle = "#2196f3";
  ctx.fillRect(
    x0 + Math.floor(farmer.x * scaleX) - 2,
    y0 + Math.floor(farmer.y * scaleY) - 2,
    4, 4
  );

  ctx.strokeStyle = "#ffeb3b";
  ctx.strokeRect(
    x0 + Math.floor(camera.x * scaleX),
    y0 + Math.floor(camera.y * scaleY),
    Math.floor(canvas.width * scaleX),
    Math.floor(canvas.height * scaleY)
  );

  ctx.strokeStyle = "#000";
  ctx.strokeRect(x0, y0, MINIMAP_SIZE, MINIMAP_SIZE);
}

function draw() {
  drawGround();
  plants.forEach(drawPlant);
  drawParticles();
  drawFarmer();
  drawMiniMap();
}

// ---------------- Loop ----------------
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>

</body>
</html>
