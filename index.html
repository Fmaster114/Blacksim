<!DOCTYPE html>
<html lang="de">
<head>
<meta charset="UTF-8">
<title>Baumwoll-Farmer</title>
<style>
  body { margin:0; background:#87ceeb; overflow:hidden; font-family:sans-serif; }
  #info {
    position:fixed; top:10px; left:10px;
    background:rgba(0,0,0,0.6);
    color:white; padding:10px; border-radius:8px;
    font-size:18px; z-index:10;
  }
  canvas { display:block; margin:auto; background:#4caf50; }
</style>
</head>
<body>

<div id="info">ðŸŒ¿ Baumwolle: <span id="cotton">0</span></div>
<canvas id="game" width="800" height="600"></canvas>

<script>
const canvas = document.getElementById("game");
const ctx = canvas.getContext("2d");

const WORLD_WIDTH = 2000;
const WORLD_HEIGHT = 2000;

let cotton = 0;
const keys = {};
const particles = [];
let tick = 0;

// ---------------- Kamera ----------------
const camera = { x: 0, y: 0 };

// ---------------- Farmer ----------------
const farmer = {
  x: 1000,
  y: 1000,
  size: 18,
  speed: 3
};

// ---------------- Pflanzen ----------------
const plants = [];
const GROW_TIME = 5000;

for (let x = 200; x < WORLD_WIDTH; x += 120) {
  for (let y = 200; y < WORLD_HEIGHT; y += 120) {
    plants.push({
      x, y,
      stage: 3,
      lastGrow: Date.now()
    });
  }
}

// ---------------- Input ----------------
window.addEventListener("keydown", e => keys[e.key] = true);
window.addEventListener("keyup", e => keys[e.key] = false);

// ---------------- Partikel ----------------
function spawnParticles(x, y) {
  for (let i = 0; i < 12; i++) {
    particles.push({
      x, y,
      vx: (Math.random()-0.5)*3,
      vy: Math.random()*-3,
      life: 40
    });
  }
}

// ---------------- Update ----------------
function update() {
  tick++;

  if (keys["w"] || keys["ArrowUp"]) farmer.y -= farmer.speed;
  if (keys["s"] || keys["ArrowDown"]) farmer.y += farmer.speed;
  if (keys["a"] || keys["ArrowLeft"]) farmer.x -= farmer.speed;
  if (keys["d"] || keys["ArrowRight"]) farmer.x += farmer.speed;

  farmer.x = Math.max(40, Math.min(WORLD_WIDTH-40, farmer.x));
  farmer.y = Math.max(40, Math.min(WORLD_HEIGHT-40, farmer.y));

  // Kamera folgt Farmer
  camera.x = farmer.x - canvas.width / 2;
  camera.y = farmer.y - canvas.height / 2;

  plants.forEach(p => {
    if (p.stage < 3 && Date.now() - p.lastGrow > GROW_TIME) {
      p.stage++;
      p.lastGrow = Date.now();
    }
  });

  if (keys[" "]) {
    plants.forEach(p => {
      const d = Math.hypot(p.x - farmer.x, p.y - farmer.y);
      if (d < 35 && p.stage === 3) {
        p.stage = 0;
        p.lastGrow = Date.now();
        cotton++;
        spawnParticles(p.x, p.y);
        document.getElementById("cotton").textContent = cotton;
      }
    });
  }

  particles.forEach(pt => {
    pt.x += pt.vx;
    pt.y += pt.vy;
    pt.vy += 0.15;
    pt.life--;
  });

  for (let i = particles.length - 1; i >= 0; i--) {
    if (particles[i].life <= 0) particles.splice(i, 1);
  }
}

// ---------------- Draw ----------------
function worldX(x){ return x - camera.x; }
function worldY(y){ return y - camera.y; }

function drawGround() {
  ctx.fillStyle = "#3e8e41";
  ctx.fillRect(0,0,canvas.width,canvas.height);

  ctx.strokeStyle = "rgba(0,0,0,0.1)";
  for (let y = -camera.y % 80; y < canvas.height; y += 80) {
    ctx.beginPath();
    ctx.moveTo(0,y);
    ctx.lineTo(canvas.width,y);
    ctx.stroke();
  }
}

function drawPlant(p) {
  const sway = Math.sin(tick/20 + p.x) * 2;

  ctx.strokeStyle = "#2e7d32";
  ctx.lineWidth = 4;
  ctx.beginPath();
  ctx.moveTo(worldX(p.x), worldY(p.y));
  ctx.lineTo(worldX(p.x), worldY(p.y + 30));
  ctx.stroke();

  const cottonCount = p.stage + 1;
  for (let i = 0; i < cottonCount; i++) {
    ctx.beginPath();
    ctx.arc(
      worldX(p.x + (Math.random()-0.5)*14),
      worldY(p.y + sway + (Math.random()-0.5)*10),
      8 + p.stage*2,
      0, Math.PI*2
    );
    ctx.fillStyle = p.stage === 3 ? "#ffffff" : "#ddd";
    ctx.fill();
    ctx.strokeStyle = "#aaa";
    ctx.stroke();
  }
}

function drawFarmer() {
  ctx.fillStyle = "rgba(0,0,0,0.25)";
  ctx.beginPath();
  ctx.ellipse(worldX(farmer.x), worldY(farmer.y + 32), 18, 6, 0, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#573E1F";
  ctx.beginPath();
  ctx.arc(worldX(farmer.x), worldY(farmer.y - 10), farmer.size, 0, Math.PI*2);
  ctx.fill();

  ctx.fillStyle = "#1976d2";
  ctx.fillRect(worldX(farmer.x - 14), worldY(farmer.y), 28, 34);
}

function drawParticles() {
  particles.forEach(p => {
    ctx.fillStyle = "rgba(255,255,255,"+(p.life/40)+")";
    ctx.beginPath();
    ctx.arc(worldX(p.x), worldY(p.y), 4, 0, Math.PI*2);
    ctx.fill();
  });
}

function draw() {
  drawGround();
  plants.forEach(drawPlant);
  drawParticles();
  drawFarmer();
}

// ---------------- Loop ----------------
function loop() {
  update();
  draw();
  requestAnimationFrame(loop);
}
loop();
</script>
</body>
</html>
